# Data Model: Semantic Color System Upgrade

**Feature**: Semantic Color System Upgrade (`007-semantic-colors`)
**Date**: 2025-12-03

---

## Overview

This document describes the data entities and their relationships for the Semantic Color System Upgrade feature. All entities are existing or minor extensions to existing models; no new domain models are introduced.

---

## Core Entities

### 1. SurfaceVariant (Enum)

**Purpose**: Represents the semantic surface level/tier in the visual hierarchy.

**Definition**:
```dart
enum SurfaceVariant {
  base,       // Low emphasis (card backgrounds, disabled states)
  elevated,   // High emphasis (modals, dialogs)
  highlight,  // Max emphasis (primary CTAs, main actions)
  tonal,      // Medium emphasis (selected states, secondary actions)
  accent,     // Decorative emphasis (special states, future)
}
```

**Usage**:
- Components pass `variant` parameter to `AppSurface` to request appropriate styling
- `AppSurface` resolves variant to corresponding `SurfaceStyle` from `AppDesignTheme`

**Relationships**:
- **Maps to** `AppDesignTheme` surface properties:
  - `base` → `surfaceBase`
  - `elevated` → `surfaceElevated`
  - `highlight` → `surfaceHighlight`
  - `tonal` → `surfaceSecondary` *(new)*
  - `accent` → `surfaceTertiary` *(new)*

**Validation**: Enum; no invalid states

---

### 2. SurfaceStyle (Data Class)

**Purpose**: Represents the complete visual definition of a surface, including color, borders, shadows, and interaction properties.

**Current Definition** (from codebase):
```dart
@Freezed
class SurfaceStyle with _$SurfaceStyle {
  const factory SurfaceStyle({
    required Color backgroundColor,
    required Color borderColor,
    required double borderWidth,
    required double borderRadius,
    required Color contentColor,
    required Color? overlayColor,
    required List<BoxShadow> shadows,
    required double blurStrength,
    required InteractionSpec? interaction,
  }) = _SurfaceStyle;
}
```

**New/Updated Fields** (for Tonal/Tertiary support):
- All existing fields remain unchanged
- `interaction` field (already present) now plays critical role in press feedback physics

**Extended Interpretation for Semantic Colors**:
| Surface | Meaning | Typical Usage |
|---------|---------|---------------|
| `surfaceBase` | Low visual priority | Card backgrounds, list items, neutral areas |
| `surfaceElevated` | Floating or modal context | Modals, dialogs, tooltips, floating UI |
| `surfaceHighlight` | Highest priority action | Primary button, CTA, critical action |
| `surfaceSecondary` *(new)* | Medium priority / selected state | Secondary button, selected tab, active filter |
| `surfaceTertiary` *(new)* | Decorative or special context | Tertiary button, accent badge, future expansion |

**Theme Implementation**: Each design language (`GlassDesignTheme`, `BrutalDesignTheme`, etc.) defines all five `SurfaceStyle` instances with distinct visual properties respecting the language's aesthetic.

**Validation Rules**:
- `borderRadius` must be ≥ 0
- `borderWidth` must be ≥ 0
- All colors must be valid `Color` objects
- `shadows` list can be empty but must be valid
- `interaction` can be null (no press feedback) or a valid `InteractionSpec`

**State Transitions**: None; surfaces are stateless value objects

---

### 3. AppDesignTheme (ThemeExtension)

**Purpose**: Single source of truth for all visual parameters in the design system. Acts as a theme contract that all design languages must implement.

**Current Properties** (excerpt):
```dart
@TailorMixin()
class AppDesignTheme extends ThemeExtension<AppDesignTheme> with _$AppDesignThemeTailorMixin {
  final SurfaceStyle surfaceBase;
  final SurfaceStyle surfaceElevated;
  final SurfaceStyle surfaceHighlight;
  // ... other properties (typography, spacing, animation, etc.)
}
```

**New Properties** *(for semantic colors)*:
```dart
@TailorMixin()
class AppDesignTheme extends ThemeExtension<AppDesignTheme> with _$AppDesignThemeTailorMixin {
  // Existing
  final SurfaceStyle surfaceBase;
  final SurfaceStyle surfaceElevated;
  final SurfaceStyle surfaceHighlight;

  // New
  final SurfaceStyle surfaceSecondary;  // Tonal surface for medium-priority/selected
  final SurfaceStyle surfaceTertiary;   // Accent surface for decorative/special

  // ... rest of properties ...

  const AppDesignTheme({
    required this.surfaceBase,
    required this.surfaceElevated,
    required this.surfaceHighlight,
    required this.surfaceSecondary,    // New required property
    required this.surfaceTertiary,     // New required property
    // ... other required properties ...
  });

  // Auto-generated by @TailorMixin:
  // - copyWith(...)
  // - lerp(...)
}
```

**Usage**:
- Accessed via `Theme.of(context).extension<AppDesignTheme>()`
- All component styling derives from this theme
- Theme switching (runtime) updates all components automatically via `ThemeData` extension

**Relationships**:
- **Extends**: `ThemeExtension<AppDesignTheme>`
- **Provides**: All `SurfaceStyle` instances + typography, spacing, animation specs
- **Consumed By**: All UI components (AppSurface, AppButton, AppNavigationBar, etc.)

**Validation**: Required by architecture; invalid if any surface property is null

**Code Generation**: All `copyWith()` and `lerp()` methods auto-generated by `@TailorMixin()` via `theme_tailor` package

---

### 4. Design Language Implementations

**Purpose**: Each design language provides concrete `AppDesignTheme` instances for its visual language.

**Files**:
- `glass_design_theme.dart` - Glassmorphism theme
- `brutal_design_theme.dart` - Neo-Brutalism theme
- `flat_design_theme.dart` - Flat/Material 3 theme
- `neumorphic_design_theme.dart` - Neumorphic theme
- `pixel_design_theme.dart` - Pixel/Retro theme

**Example: GlassDesignTheme** *(snippet)*:
```dart
class GlassDesignTheme {
  static AppDesignTheme light() => AppDesignTheme(
    surfaceBase: SurfaceStyle(
      backgroundColor: Colors.white.withValues(alpha: 0.10),
      blurStrength: 10.0,
      // ... other properties
    ),
    surfaceSecondary: SurfaceStyle(
      backgroundColor: scheme.primary.withValues(alpha: 0.12),  // Tinted frost
      blurStrength: 15.0,  // Denser glass
      borderColor: Colors.white.withValues(alpha: 0.3),
      // ... other properties
    ),
    surfaceHighlight: SurfaceStyle(
      backgroundColor: Colors.white.withValues(alpha: 0.25),
      blurStrength: 20.0,
      // ... other properties
    ),
    // ... other properties (typography, spacing, etc.)
  );

  static AppDesignTheme dark() => AppDesignTheme(
    surfaceBase: SurfaceStyle(
      backgroundColor: Colors.black.withValues(alpha: 0.15),
      // ... adjusted for dark mode
    ),
    surfaceSecondary: SurfaceStyle(
      backgroundColor: scheme.primary.withValues(alpha: 0.25),  // Higher alpha for visibility
      blurStrength: 15.0,
      borderColor: Colors.white.withValues(alpha: 0.2),
      // ... other properties
    ),
    // ... rest of properties
  );
}
```

**Constraints**:
- All implementations must provide all five surfaces (Base, Elevated, Highlight, Secondary, Tertiary)
- Visual properties must be internally consistent (visual hierarchy maintained across surfaces)
- Light and Dark variants must be provided
- No component-level conditional logic; all styling derived from `AppDesignTheme` properties

---

### 5. InteractionSpec (Data Class)

**Purpose**: Defines interaction physics (press feedback) for surfaces.

**Current Definition** (existing):
```dart
@Freezed
class InteractionSpec with _$InteractionSpec {
  const factory InteractionSpec({
    required double pressedScale,  // e.g., 0.97 for 3% reduction
    required double glowOpacity,   // e.g., 0.2 for glow effect
    required Duration duration,    // Animation duration
    required Curve curve,          // Animation curve
  }) = _InteractionSpec;
}
```

**Usage in Semantic Colors**:
- `AppSurface` reads `interaction?.pressedScale` to determine press feedback
- All surfaces (including new Tonal and Tertiary) inherit interaction from `SurfaceStyle.interaction`
- Consistent physics across all themes

**Default Behavior**: If `interaction` is null, no press animation (scale defaults to 1.0)

---

### 6. Component Adaptations

#### AppButton
**New Parameter**: `variant: SurfaceVariant = SurfaceVariant.highlight`

**Logic**:
```dart
class AppButton {
  final SurfaceVariant variant;
  // ... other parameters

  @override
  Widget build(BuildContext context) {
    return AppSurface(
      variant: variant,  // Determines which SurfaceStyle to use
      onTap: onPressed,
      interactive: true,
      // ... other properties
    );
  }
}
```

**Semantic Mapping**:
- `SurfaceVariant.highlight` → Primary CTA ("Publish", "Save", "Continue")
- `SurfaceVariant.tonal` → Secondary action ("Save Draft", "Skip", "Maybe Later")
- `SurfaceVariant.base` → Tertiary action ("Cancel", "Dismiss", "Reset")

---

#### AppNavigationBar
**New Logic**: Selected item renders with Tonal pill-shaped indicator

**State**:
```dart
class _NavigationItem {
  final int index;
  final bool isSelected;  // Derived from currentIndex
}
```

**Rendering Logic**:
```dart
// Selected: Tonal indicator
if (isSelected) {
  AppSurface(
    variant: SurfaceVariant.tonal,
    // ... pill shape properties
  );
}

// Unselected: transparent base
else {
  AppSurface(
    variant: SurfaceVariant.base,
    style: theme.surfaceBase.copyWith(
      backgroundColor: Colors.transparent,
      borderWidth: 0,
    ),
  );
}
```

**State Transitions**: Selection changes are immediate; animations handled by `AppSurface`

---

#### AppTag
**New Parameter**: `isSelected: bool = false`

**Logic**:
```dart
class AppTag {
  final String label;
  final bool isSelected;

  @override
  Widget build(BuildContext context) {
    final targetVariant = isSelected ? SurfaceVariant.tonal : SurfaceVariant.base;

    return AppSurface(
      variant: targetVariant,
      // ... other properties
    );
  }
}
```

**Semantic Mapping**:
- `isSelected: true` → Applied filter tag (rendered with Tonal surface)
- `isSelected: false` → Available/unselected tag (rendered with Base surface)

---

## Data Relationships Diagram

```
AppDesignTheme (Single Source of Truth)
├── surfaceBase: SurfaceStyle
│   └── backgroundColor, borderColor, borderWidth, borderRadius, contentColor, shadows, blurStrength, interaction
├── surfaceElevated: SurfaceStyle
│   └── (same fields)
├── surfaceHighlight: SurfaceStyle
│   └── (same fields)
├── surfaceSecondary: SurfaceStyle ← NEW (for Tonal/medium-priority)
│   └── (same fields)
└── surfaceTertiary: SurfaceStyle ← NEW (for Accent/decorative)
    └── (same fields)

AppSurface (Renderer)
├── variant: SurfaceVariant → resolves to SurfaceStyle from theme
├── style: SurfaceStyle? (optional override)
└── interaction: InteractionSpec (from resolved style)

Components (AppButton, AppNavigationBar, AppTag)
├── variant: SurfaceVariant → passed to AppSurface
└── isSelected/variant parameters → determines SurfaceVariant

DesignLanguageImplementation (GlassDesignTheme, BrutalDesignTheme, etc.)
└── provides all 5 SurfaceStyle instances with language-specific visuals
```

---

## Validation Rules Summary

| Entity | Validation Rule |
|--------|-----------------|
| `SurfaceVariant` | Must be one of 5 enum values; no invalid states |
| `SurfaceStyle` | All colors valid; borderRadius, borderWidth ≥ 0; shadows list valid |
| `AppDesignTheme` | All 5 surfaces required; no null properties |
| `InteractionSpec` | Optional; if present, duration > 0, curve not null |
| `AppButton.variant` | Must map to valid `SurfaceVariant` |
| `AppNavigationBar.selectedIndex` | Must be ≥ -1 (or null); selects which item displays Tonal |
| `AppTag.isSelected` | Boolean; auto-switches variant to Tonal if true |

---

## State Management

All entities in this data model are **immutable value objects**. State management occurs at the widget level:
- `AppDesignTheme` is provided via Flutter's `ThemeData.extensions`
- Component state (e.g., `AppNavigationBar.currentIndex`, `AppTag.isSelected`) is managed by the containing widget
- `AppSurface` manages only internal interaction state (press feedback) via `_isPressed`

No backend or persistent state is involved.

---

## Code Generation

- `AppDesignTheme`: Auto-generates `copyWith()` and `lerp()` via `@TailorMixin()` (theme_tailor package)
- `SurfaceStyle`: Auto-generates equality and copyWith via `@freezed` (freezed package)
- All `.tailor.dart` and `.freezed.dart` files are generated by `dart run build_runner`

---

## Next Steps

1. ✅ Data model documented
2. Proceed to implementation of theme updates (plan.md section 1.1–1.2)
3. Implement components (plan.md section 1.4)
4. Create golden tests (plan.md section 1.5)
