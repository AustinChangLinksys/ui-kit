# Implementation Plan: GenUI Client-Side Orchestration (Mock-First PoC)

**Branch**: `008-genui-mockfirst-poc` | **Date**: 2025-12-03 | **Spec**: [spec.md](spec.md)
**Input**: Feature specification from `/specs/008-genui-mockfirst-poc/spec.md`

## Summary

Build a mock-first proof-of-concept that validates end-to-end GenUI logic (JSON parsing, UI rendering, schema generation) without network dependency. Implements a unified `ContentGenerator` interface with `MockContentGenerator` for hardcoded responses, robust JSON parser using Design by Contract (DBC), and dynamic UI rendering from Claude's tool_use format. Enables seamless transition to AWS Bedrock in Phase 3 through clean architectural separation.

## Technical Context

**Language/Version**: Dart 3.0+, Flutter 3.13+
**Primary Dependencies**: `flutter`, `genui` (planned), `ui_kit` (parent package), `http` (future for AWS)
**Storage**: `ai_config.json` (local assets, no persistent storage for Phase 1)
**Testing**: `flutter_test`, `alchemist` (golden tests matching UI Kit standards)
**Target Platform**: Android/iOS (Flutter mobile), Chrome Web (future)
**Project Type**: Mobile (single Flutter package within UI Kit monorepo)
**Performance Goals**: MockContentGenerator <100ms response time (local, no I/O bound), JSON parser <50ms for typical payloads
**Constraints**: No external network calls during Phase 1; must maintain UI Kit architectural standards (no business logic, dependency hygiene)
**Scale/Scope**: ~200-300 lines core logic, 3 mock scenarios, 2-3 UI components for testing, Phase 1-only scope

## Constitution Check

**GATE: Architecture & Dependency Hygiene**

1. ✅ **Physical Isolation** (2.1): New `generative_ui` module exists as independent Dart Package under `lib/src/`
2. ✅ **Dependency Hygiene** (2.2): Forbidden dependencies (bloc, provider, http client, firebase) NOT used in Phase 1
3. ✅ **No Runtime Type Checks** (6.1): Parser uses Value Objects + Design by Contract, not `runtimeType` checks
4. ✅ **Composition over Inheritance** (5.3): `MockContentGenerator` implements interface, doesn't inherit from concrete types
5. ✅ **AppSurface Mandatory** (5.1): All UI rendering uses `AppSurface` for backgrounds/borders/effects
6. ⚠️ **Testing Standards** (12.2): Golden tests will follow Safe Mode protocol with explicit constraints + background color injection (deferred to Phase 2 if needed)

**Status**: ✅ **APPROVED** - No violations. Clean Architecture maintained. Ready for Phase 0 research.

## Project Structure

### Documentation (this feature)

```text
specs/008-genui-mockfirst-poc/
├── spec.md                         # Specification (done)
├── plan.md                         # This file (Phase 0 output)
├── research.md                     # Phase 0: Technology research (TBD)
├── data-model.md                   # Phase 1: Entity definitions (TBD)
├── quickstart.md                   # Phase 1: Getting started guide (TBD)
├── contracts/                      # Phase 1: API contracts (TBD)
│   ├── content_generator.dart      # ContentGenerator interface
│   └── mock_responses.json         # Mock response schemas
├── checklists/
│   └── requirements.md             # Quality checklist (done)
└── tasks.md                        # Phase 2: Task breakdown (generated by /speckit.tasks)
```

### Source Code (Flutter Package)

```text
lib/src/generative_ui/
├── lib/
│   ├── src/
│   │   ├── domain/                           # [Pure Dart] Business logic, no dependencies
│   │   │   ├── entities/
│   │   │   │   ├── gen_tool.dart            # Tool definition (Value Object)
│   │   │   │   ├── llm_response.dart        # Response model
│   │   │   │   └── gen_exception.dart       # Custom exceptions (ParsingException)
│   │   │   ├── repositories/
│   │   │   │   └── i_content_generator.dart # Abstract interface (Repository Pattern)
│   │   │   └── usecases/
│   │   │       └── orchestrate_ui_flow.dart # Orchestration logic
│   │   ├── data/                            # [Implementation] Concrete implementations
│   │   │   ├── datasources/
│   │   │   │   ├── mock_content_generator.dart  # MockContentGenerator impl
│   │   │   │   └── aws_content_generator.dart   # Placeholder for Phase 3
│   │   │   └── utils/
│   │   │       ├── response_parser.dart     # DBC: JSON parsing + sanitization
│   │   │       └── schema_generator.dart    # Flutter → JSON Schema
│   │   └── presentation/
│   │       ├── gen_ui_wrapper.dart          # StatelessWidget wrapper for GenUI
│   │       └── controllers/
│   │           └── gen_ui_controller.dart   # State management (if needed)
│   ├── generative_ui.dart                   # Library export
│   └── constants.dart                       # Config constants
├── assets/
│   └── ai_config.json                       # Configuration template
├── test/
│   ├── domain/
│   │   ├── entities/                        # Entity unit tests
│   │   └── usecases/                        # UseCase tests
│   ├── data/
│   │   ├── datasources/                     # MockContentGenerator unit tests
│   │   └── utils/
│   │       ├── response_parser_test.dart    # Parser robustness tests (5 malformed formats)
│   │       └── schema_generator_test.dart   # Schema generation tests
│   └── presentation/
│       └── gen_ui_wrapper_test.dart         # Integration tests (parser → rendering)
└── pubspec.yaml                             # Package definition
```

**Structure Decision**: Single Flutter package architecture (Option 1) with Clean Architecture layers (Domain/Data/Presentation). Domain layer is pure Dart (testable without simulator). Data layer implements concrete providers. Presentation layer integrates with Flutter UI Kit.

### Key Files

- **`contracts/content_generator.dart`**: Interface definition (defines contract)
- **`data/utils/response_parser.dart`**: Core parsing logic with DBC (preconditions/postconditions)
- **`data/datasources/mock_content_generator.dart`**: Keyword-based mock responses (includes 3 predefined scenarios: Wi-Fi, Info, Error)
- **`assets/ai_config.json`**: Configuration structure (even if unused by Mock)
- **`test/`**: Comprehensive test suite validating parser robustness and mock scenarios

## Complexity Tracking

No constitutional violations justifying complexity increases. The design follows established UI Kit patterns (composition, DDS, no runtime type checks). All complexity is inherent to the feature requirements (parser robustness, schema generation, mock adaptation) and justified by Phase 3 transition needs.
